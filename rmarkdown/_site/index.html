<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Spatial Tools</title>

<script src="site_libs/header-attrs-2.27/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/spacelab.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.13.2/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-6.4.2/css/all.min.css" rel="stylesheet" />
<link href="site_libs/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>






<link rel="stylesheet" href="spatialtools.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}

.tocify-subheader {
  display: inline;
}
.tocify-subheader .tocify-item {
  font-size: 0.95em;
}

</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Spatial Tools</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-cube"></span>
     
    Introduction
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fa fa-layer-group"></span>
     
    Shiny examples
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Simple Spatial Tools</li>
    <li>
      <a href="https://marine-ecologist.shinyapps.io/rotate-polygons/">  a) rotate polygons</a>
    </li>
    <li>
      <a href="https://marine-ecologist.shinyapps.io/draw-plots/">  b) draw plots</a>
    </li>
    <li class="dropdown-header">Dynamic Raster classification</li>
    <li>
      <a href="https://marine-ecologist.shinyapps.io/classify-rasters/">  a) static rasters</a>
    </li>
    <li>
      <a href="https://marine-ecologist.shinyapps.io/classify-rasters-wms/">  b) dynamic rasters</a>
    </li>
    <li class="dropdown-header">Interactive tools</li>
    <li>
      <a href="https://marine-ecologist.shinyapps.io/Interactive-Ocean-Data/">  i) Visualise raster time-series</a>
    </li>
    <li>
      <a href="https://marine-ecologist.shinyapps.io/remove-zones/">  ii) Exclude map zones</a>
    </li>
    <li>
      <a href="https://marine-ecologist.shinyapps.io/spatial-decision-tool/">  iii) Dynamic spatial selection</a>
    </li>
  </ul>
</li>
<li>
  <a href="set-polygons.html">
    <span class="fa fa-rotate-left"></span>
     
    Site selection
  </a>
</li>
<li>
  <a href="https://github.com/marine-ecologist/spatial-tools/">
    <span class="fa fa-github"></span>
     
    GitHub
  </a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Spatial Tools</h1>

</div>


<div
id="a-collection-of-r-and-javascript-tools-for-interactive-mapping-ecology-and-conservation"
class="section level4">
<h4>a collection of R and javascript tools for interactive mapping,
ecology, and conservation</h4>
<div id="george.roffcsiro.au-05082024" class="section level5">
<h5><a href="mailto:george.roff@csiro.au"
class="email">george.roff@csiro.au</a> (05/08/2024)</h5>
<p><br></p>
<p>Collection of spatial tools developed in <code>r</code>,
<code>leaflet</code> and <code>shiny</code> that build upon
<code>leaflet draw</code> functionality implemented in
<code>leafem</code> and <code>leaflet.extras</code> that facilitate
spatial planning and data visualisation. Note: these tools are
<strong>functional</strong> examples for development and should be
adapted if used (i.e. coded in a more efficient way).</p>
<p><br></p>
</div>
</div>
<div id="simple-spatial-tools" class="section level2">
<h2>Simple spatial tools</h2>
<hr>
<div id="a-rotate-polygons" class="section level3">
<h3>a) rotate polygons</h3>
<p><img src="images/rotate.gif" width="900" /></p>
<p>Adds rotate functionality to <code>leaflet</code> by implementing the
javascript leaflet plugin <code>Leaflet.draw.rotate</code> from <a
href="https://github.com/onaci/Leaflet.draw.rotate"
class="uri">https://github.com/onaci/Leaflet.draw.rotate</a> in the <a
href="https://github.com/trafficonese/leaflet.extras"><code>leaflet_extras</code></a>
plugin <a
href="http://leaflet.github.io/Leaflet.draw/docs/leaflet-draw-latest.html"><code>Leaflet.Draw</code></a>
by using a custom version of the <a
href="https://github.com/w8r/Leaflet.Path.Transform"><code>Leaflet.Path.Transform</code></a>
plugin. Useful for defining selecting non-gridded raster values for
dynamic classification (see “Spatial decision tools” below for
implementation).</p>
<ul>
<li>Link to <a
href="https://github.com/marine-ecologist/spatialtools/blob/main/r/rotate-polygons_0.1.R">code</a></li>
<li>Link to <a
href="https://marine-ecologist.shinyapps.io/rotate-polygons/">shiny
example</a> </br> </br></li>
</ul>
<hr>
</div>
<div id="b-draw-plots" class="section level3">
<h3>b) draw plots</h3>
<p><img src="images/ezgif-7-67575a8c44.gif" width="900" /></p>
<p>Creating fixed grid size plots (e.g. 100m x 100m, 1ha) within leaflet
currently yet to be implemented. Note: <code>leaflet</code> uses
<code>EPSG:4326</code> coordinate reference system, so dimensions are
approximate <strong>°</strong>0.00045 degrees lat/lon coordinates.</p>
<ul>
<li>Link to <a
href="https://github.com/marine-ecologist/spatialtools/blob/main/r/draw-plots_0.1.R">code</a></li>
<li>Link to <a
href="https://marine-ecologist.shinyapps.io/draw-plots/">shiny
example</a></li>
</ul>
<p></br> </br></p>
</div>
</div>
<div id="dynamic-raster-classification" class="section level2">
<h2>Dynamic raster classification</h2>
<p></br></p>
<hr>
<div id="a-static-rasters" class="section level3">
<h3>a) static rasters</h3>
<p><img src="images/classify-01.gif" width="900" /></p>
<p>D ynamic classification of static rasters by interactive
reclassification of <strong>n</strong> bins and range for each interval.
Adjusting the end point of the slider will dynamically shift the start
point of the next bin. Example code below uses simulated raster data in
<code>R</code> via <code>gstat</code> to approximate clustered raster
cells.</p>
<ul>
<li>Link to <a
href="https://github.com/marine-ecologist/spatialtools/blob/main/r/classify-rasters_0.1.R">code</a></li>
<li>Link to <a
href="https://marine-ecologist.shinyapps.io/classify-rasters/">shiny
example</a> </br> </br></li>
</ul>
<hr>
</div>
<div id="b-dynamic-rasters" class="section level3">
<h3>b) dynamic rasters</h3>
<p><img src="images/classify-wms.gif" width="900" /></p>
<p>Allows dynamic classification of rasters as above, but uses dynamic
subsetting of spatial data from the current map extent. The code
extracts satellite data (e.g. SST, Chl a) from the <a
href="https://www.ncei.noaa.gov/erddap/info/index.html?page=1&amp;itemsPerPage=1000">NOAA
ERDAPP</a> servers for the extent of the current map area (see below
Interactive raster data visualisation for explanation), and then
implements interactive reclassification of <em>n</em> bins and range for
each interval. Note - the approach is similar to importing geoserver WMS
tiles for a given map extent except uses raw data in <code>.csv</code>
format to create raster files when zoom/recenter or changing
classification from ordinal/continuous data.</p>
<p>Example uses Multiscale Ultrahigh Resolution (MUR) sea surface
temperature (SST) from <a
href="https://eastcoast.coastwatch.noaa.gov/cw_podaac-mur_sst.php">coastwatch</a>
at 0.01° resolution with a 7-day lag from present date.</p>
<ul>
<li>Link to <a
href="https://github.com/marine-ecologist/spatialtools/blob/main/r/classify-rasters-wms_0.1.R">code</a></li>
<li>Link to <a
href="https://marine-ecologist.shinyapps.io/classify-rasters-wms/">shiny
example</a></li>
</ul>
<p></br> </br></p>
<hr>
</div>
</div>
<div id="interactive-spatial-tools" class="section level2">
<h2>Interactive spatial tools</h2>
<p></br></p>
<div id="i-visualise-raster-time-series" class="section level3">
<h3>i) Visualise raster time-series</h3>
<p><img src="images/interactive.gif" width="900" /></p>
<p>Interactive visualisation of historical daily raster data from the
NOAA ERDAPP servers.</p>
<p>Features:</p>
<ul>
<li><p>Select satellite data sources from from ERDAPP servers</p></li>
<li><p>Specify dates for data</p></li>
<li><p>Use WMS base maps (coral atlas, ESRI imagery)</p></li>
<li><p>Allow custom palettes (e.g. NOAA degree heating weeks)</p></li>
</ul>
<p>Example includes Great Barrier Reef and Ningloo (Western Australia)
and data sourced from NOAA CRW and MUR. Note: currently uses
re-rendering of raster images via <code>.csv</code> rather than direct
conversion of .nc files, which is potentially inefficient - revisit with
<code>stars::read_stars</code> over <code>terra::rast</code> at later
stage</p>
<ul>
<li>Link to <a
href="https://github.com/marine-ecologist/spatialtools/blob/main/r/time-series_0.1.R">code</a></li>
<li>Link to <a
href="https://marine-ecologist.shinyapps.io/Interactive-Ocean-Data/">shiny
example</a></li>
</ul>
<p></br> </br></p>
<hr>
</div>
<div id="ii-exclude-map-zones" class="section level3">
<h3>ii) Exclude map zones</h3>
<p><img src="images/remove-zones.gif" /></p>
<p>Leaflet implementation of dynamic cropping of vector and raster
layers to exclude zones from existing datasets prior to site selection.
Users / stakeholders can draw zones/areas on the map, which are used to
inversely mask the raster layer, updating the baselayers to exclude from
further analysis. Code includes vector Allen coral atlas data and an
aggregated raster layer generated by a Gaussian random field
simulation.</p>
<ul>
<li>Link to <a
href="https://github.com/marine-ecologist/spatialtools/blob/main/r/remove-zones_0.1.R">code</a></li>
<li>Link to <a
href="https://marine-ecologist.shinyapps.io/spatial-decision-tool/">shiny
example</a></li>
</ul>
<p></br> </br></p>
<hr>
</div>
<div id="iii-dynamic-spatial-selection" class="section level3">
<h3>iii) Dynamic spatial selection</h3>
<p><img src="images/select.gif" /></p>
<p>Dynamic site selection tool for allowing users to interactively
explore and analyze spatial layers through a <code>leaflet</code> map
interface. Example includes simulated raster data of varying gridcell
sizes (Temperature, Sedimentation, DHW, Wave Exposure, Chlorophyll,
Salinity) and a “restoration score” (basic additive algorithm for
categorical raster layers). Underlying code categorises each raster
datalayer into ordinal values (see classify rasters) and calculates an
unweighted mean, but can be implemented with any algorithm.</p>
<ul>
<li>Link to <a
href="https://github.com/marine-ecologist/spatialtools/blob/main/r/dynamic-spatial-selection_0.1.R">code</a></li>
<li>Link to <a
href="https://marine-ecologist.shinyapps.io/spatial-decision-tool/">shiny
example</a></li>
</ul>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3,h4",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = false;
    options.smoothScroll = false;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
